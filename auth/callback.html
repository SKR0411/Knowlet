<!DOCTYPE html>
<html>
<head>
    <title>Supabase OAuth Callback</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="spinner"></div>
    <h1 id="status-title">Processing Login...</h1>
    <p id="status-message">Please wait while we secure your session and redirect you.</p>

    <script>
        alert(window.location.hash)
        
        const hash = window.location.hash;

        function parseHash(hash) {
            const clean = hash.startsWith("#") ? hash.slice(1) : hash;
            const params = {};
            const parts = clean.split("&");
        
            for (const part of parts) {
                const [key, value] = part.split("=");
                params[key] = decodeURIComponent(value || "");
            }
        
            return params;
        }
        
        const session = parseHash(hash);
        
        alert(session.provider_token);  // <-- USE THIS
        
        async function fetchGoogleUserInfo(providerToken) {
            const response = await fetch("https://www.googleapis.com/oauth2/v3/userinfo", {
                headers: {
                    Authorization: `Bearer ${providerToken}`
                }
            });
        
            const data = await response.json();
            alert(1)
            return data;
        }
        
        fetchGoogleUserInfo(session.provider_token)
            .then(info => document.write("Google user info:", JSON.stringify(info)));

    </script>
</body>
</html>