<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Finishing Login...</title>
</head>
<body>

<p>Finishing loginâ€¦</p>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<script>
    const supabase = supabase.createClient(
        "https://ampwczxrfpbqlkuawrdf.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFtcHdjenhyZnBicWxrdWF3cmRmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3OTk4MzYsImV4cCI6MjA3ODM3NTgzNn0.hFib9Y5x02b5VWjKuNi1XkUYvycmrp0DQhnwNkOGJEU"
    );

    async function finishLogin() {
        const params = new URLSearchParams(window.location.search);
        const code = params.get("code");

        if (!code) {
            console.error("No code returned from Google");
            return;
        }

        const { data, error } = await supabase.auth.exchangeCodeForSession({ code });

        if (error) {
            console.error("Auth error:", error);
            return;
        }

        // Save user info (optional)
        const user = data.user;
        localStorage.setItem("knowletUser", JSON.stringify(user));

        // Redirect to profile
        window.location.href = "/profile.html";
    }

    finishLogin();
</script>

</body>
</html>